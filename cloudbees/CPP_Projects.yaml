# EPICS V4 C++ Jenkins Jobs (aka job builder projects) on CloudBees
#
# Jenkins Job Builder configuration
#
# Author: Ralph Lange <ralph.lange@gmx.de>
# Copyright (C) 2015 ITER Organization.
# All rights reserved. Use is subject to license terms.

- project:
    name: pvCommonCPP
    repo: '{name}'
    module: pvCommon
    extra-description: ', build with Micro-Benchmarks'
    microbench_axis:
        - MB_YES
    jobs:
        - '{name}-lib-jobs':
            downstream: 'pvAccessCPP_Build,normativeTypesCPP_Build,pvaSrvCPP_Build,exampleCPP_Build'
        - '{name}-release-branch-jobs':
            branch:
                - '4.0'
                - '4.1':
                    downstream: 'pvAccessCPP_Release-4.1-Build'

- project:
    name: pvDataCPP
    repo: '{name}'
    module: pvData
    jobs:
        - '{name}-lib-jobs':
            downstream: 'pvAccessCPP_Build,normativeTypesCPP_Build,pvaSrvCPP_Build,pvDatabaseCPP_Build,exampleCPP_Build,pvaPy_Build'
        - '{name}-release-branch-jobs':
            branch:
                - '4.0'

- project:
    name: pvAccessCPP
    repo: '{name}'
    module: pvAccess
    extra-description: ', with or without Micro-Benchmarks'
    microbench_axis:
        - MB_YES
        - MB_NO
    jobs:
        - '{name}-lib-jobs':
            downstream: 'pvaSrvCPP_Build,exampleCPP_Build,pvDatabaseCPP_Build,pvaClientCPP_Build,pvaPy_Build'
        - '{name}-release-branch-jobs':
            branch:
                - '4.0':
                    extra-description: ', build with Micro-Benchmarks'
                    microbench_axis:
                        - MB_YES
                - '4.1':
                    downstream: 'pvaPy_Release-0.5-Build'

- project:
    name: normativeTypesCPP
    repo: '{name}'
    module: normativeTypes
    jobs:
        - '{name}-lib-jobs':
            downstream: 'pvaClientCPP_Build,pvaPy_Build'
        - '{name}-release-branch-jobs':
            branch:
                - '4.0':
                    extra-description: ', build with Micro-Benchmarks'
                    microbench_axis:
                        - MB_YES

- project:
    name: pvaClientCPP
    repo: '{name}'
    module: pvaClient
    jobs:
        - '{name}-lib-jobs':
            downstream: 'pvaPy_Build'

- project:
    name: pvaPy
    repo: '{name}'
    module: '{name}'
    language: 'C++/Python'
    jobs:
        - '{name}-lib-jobs'
        - '{name}-release-branch-jobs':
            branch:
                - '0.5'

- project:
    name: pvaSrvCPP
    repo: pvaSrv
    module: pvaSrv
    jobs:
        - '{name}-lib-jobs':
            downstream: 'pvDatabaseCPP_Build'
        - '{name}-release-branch-jobs':
            branch:
                - '0.10':
                    extra-description: ' (release 0.10 only against Base 3.14), build with Micro-Benchmarks'
                    microbench_axis:
                        - MB_YES
                    base_axis:
                        - 3.14.12.5

- project:
    name: pvDatabaseCPP
    repo: '{name}'
    module: pvDatabase
    jobs:
        - '{name}-lib-jobs'
        - '{name}-release-branch-jobs':
            branch:
                - '4.0':
                    extra-description: ' (release 4.0 only against Base 3.14), build with Micro-Benchmarks'
                    microbench_axis:
                        - MB_YES
                    base_axis:
                        - 3.14.12.5

- project:
    name: exampleCPP
    repo: '{name}'
    module: example
    allow-no-artifact: true
    jobs:
        - '{name}-prod-jobs'
        - '{name}-release-branch-jobs':
            branch:
                - '4.0':
                    extra-description: ', build with Micro-Benchmarks'
                    microbench_axis:
                        - MB_YES
